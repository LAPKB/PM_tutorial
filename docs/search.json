[
  {
    "objectID": "overview.html",
    "href": "overview.html",
    "title": "3¬† Overview",
    "section": "",
    "text": "3.1 R6 architecture\nThis chapter provides an overview of the architecture of the Pmetrics package, including its main software engines, control functions, and other functions for data manipulation, model selection, diagnostics, and plotting.\nAs of v. 2.0, Pmetrics uses an ‚ÄúR6‚Äù architecture less dependent on reading and writing files, preserving hard drive space and speeding execution, since file I/O is slow. The goal is to simplfy work within a session by eliminating the need to repeatedly copy and paste files from one folder to the next whenever a new fit is executed. Storing critical objects in memory means they can be used without accessing files.\nHowever, data and model files are still used for longer term storage and preserving work from one session to another. The format of those files, both data and model, will be familiar to long term Pmetrics users.\nData files are generally .csv and the format is detailed in the chapter on data. A model can be read from a text file or can be defined directly in R. The easiest way to accomplish this is with our model builder app. Whether choosing to define models in R, with the builder app, or in a .txt file, details can be found in models.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "overview.html#software-engines",
    "href": "overview.html#software-engines",
    "title": "3¬† Overview",
    "section": "3.2 Software engines ‚öôÔ∏è",
    "text": "3.2 Software engines ‚öôÔ∏è\nThere are three main software engines that Pmetrics controls currently.\n\n\n\n\n\n\nNPAG is the Non-parametric Adaptive Grid software. It will create a non-parametric population model consisting of discrete support points, each with a set of estimates for all parameters in the model plus an associated probability (weight) of that set of estimates. There can be at most one point for each subject in the study population. There is no need for any assumption about the underlying distribution of model parameter values.\nNPOD is the Non-parametric Optimal Design software. Like NPAG, it will create a non-parametric population model consisting of discrete support points, each with a set of estimates for all parameters in the model plus an associated probability (weight) of that set of estimates. While NPAG searches parameter hyperspace randomly, NPOD uses likelihood gradients to search systematically. This usually results in faster convergence, but currently, NPOD is more likely to get stuck in a ‚Äúlocal‚Äù minimum of the likelihood surface, i.e.¬†it has a higher chance of not finding the globally optimal support points. NPOD is under active development.\nThe Simulator is a semi-parametric Monte Carlo simulation software program that can use the output of NPAG of NPOD to build randomly generated response profiles (e.g.¬†time-concentration curves) for a given population model, parameter estimates, and data input. Simulation from a non-parametric joint density model, i.e.¬†NPAG output, is possible, with each point serving as the mean of a multivariate normal distribution, weighted according to the weight of the point. The covariance matrix of the entire set of support points is divided equally among the points for the purposes of simulation.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "overview.html#model-fitting",
    "href": "overview.html#model-fitting",
    "title": "3¬† Overview",
    "section": "3.4 Model fitting üéõÔ∏è",
    "text": "3.4 Model fitting üéõÔ∏è\nPmetrics uses PM_data to create data objects and PM_model to create model objects. When a model is created, it is compiled and ready to be combined with the data and parameters within the model‚Äôs $fit() method, generating probability distributions for primary model parameters. PM_data and PM_model objects and their methods are extensively documented within R by using the help(command) or ?command syntax and in subsequent chapters here.\nThe $fit() method replaces these Legacy functions: ITrun, ERRrun, NPrun.\nInvoking the simulator in R6 becomes a method attached to PM_result objects or by using PM_sim$new() for models, parameter value probability distributions and template data not derived from a previous fit, e.g.¬†when lifted from an article.\nOnce a PM_model object is compiled, combine it with a data file, and fit the model to the data using the $fit() method as we saw in the Workflow chapter.\n\nrun1 &lt;- mod1$fit(data, ...) #... are options listed in ?PM_model for the $fit method\n\n\n3.4.1 Simulation üìà\nFor the Simulator, the $sim method for a PM_result object will execute the program directly within R and return a PM_sim object.\n\nrun1 &lt;- PM_load(1)\nsim1 &lt;- run1$sim(data = \"new.csv\") # uses the model and parameter joint density from run1, but replaces the data with new.csv\n\nThe first line loads previous results of run 1 into a PM_result object called run1. The second line uses the model and prior in run1 with new data template. sim1 is a PM_sim object.\nAn equivalent method is to create a new PM_sim is directly with PM_sim$new(). It also returns a PM_sim() object, i.e.¬†there is no longer any need to run the Legacy function SIMparse. Creating simulations this way allows total freedom with respect to the model, the prior, and the data template.\n\nsim1 &lt;- PM_sim$new(poppar = list(...), model = \"model.txt\", data = \"new.csv\")\n\nSee simulation for details on specifying poppar this way.\nThe simulation results are returned automatically to the object assigned to contain the output of the simulation, e.g.¬†sim1 below.\n\nsim1 &lt;- PM_result$sim(...)\n\nAs mentioned above, there is no longer any need to use the Legacy SIMparse function, because the both the SIMrun and SIMparse Legacy functions are combined within the $sim() method for PM_result objects or the PM_sim$new() method.\n\n\n3.4.2 Saving üíæ\nThe Pmetrics R6 objects PM_data, PM_result, PM_sim, PM_valid, and PM_pta all have a $save() method. This method saves the object to the hard drive in the current working directory by default. The format is .rds which is a binary format used by R to save individual objects. The purpose of the $save() method is to enable retrieval of the object at a later time.\n\n\n3.4.3 Loading üìÇ\nAfter a successful model fit, PM_load() creates a PM_result object rather than loading run results into the current environment and suffixed with the run number as for Legacy Pmetrics, e.g., op.1, final.1, etc. are no longer are created.\n\nrun1 &lt;- PM_load(1)\nrun1$op$plot()\n\nTo load previously saved .rds ojbects, for PM_sim, PM_valid, and PM_pta, use the $new() method and provide the full or relative path (if not in the working directory) and name of the .rds file created by the corresponding $save() method.\n\nsim1$save(\"sim.rds\")\n# come back another time and do this\nsim1 &lt;- PM_sim$new(\"sim.rds\")\n\n\n\n3.4.4 Report generation üìÑ\nThe PM_report function is automatically run at the end of a successful run, and it will generate an HTML page with summaries of the run, as well as the .Rdata files and other objects. The default browser will be automatically launched for viewing of the HTML report page. You can also regenerate the report at any time by calling the $report() method on a PM_result object.\n\nrun1 &lt;- PM_load(1)\nrun1$report() # regenerates the report",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "overview.html#other-functions",
    "href": "overview.html#other-functions",
    "title": "3¬† Overview",
    "section": "3.5 Other functions",
    "text": "3.5 Other functions\nWithin Pmetrics there are also functions to manipulate data.csv files and process and plot extracted data.\n\n3.5.1 Data manipulation\nComparison between the current and the Legacy methods are shown for education.\n\n\n\n\n\n\n\n\nFunction\nR6\nLegacy\n\n\n\n\nRead data file\nPM_data$new()\nPMreadMatrix()\n\n\nCheck data file\nEmbedded in PM_data$new()\nPMcheck()\n\n\nWrite data file\nPM_data$save()\nPMwriteMatrix()\n\n\nConvert calendar dates and clock times\nEmbedded in PM_data$new()\nPMmatrixReltime()\n\n\nConvert from old USC\\*PACK .wrk format\nPMwrk2csv()\nPMwrk2csv()\n\n\nConvert from NONMEM\nNM2PM()\nNM2PM()\n\n\n\n\n\n\n\n\n\n3.5.2 Model selection and diagnostics\nComparison between the current and the Legacy methods are shown for education.\n\n\n\n\n\n\n\n\nFunction\nR6\nLegacy\n\n\n\n\nCompare models\nPM_compare(PM_result1, PMresult2,‚Ä¶)\nPMcompare(1, 2, ‚Ä¶)\n\n\nPlot residuals\nPM_result$op$plot(resid = T,‚Ä¶)\nplot(op, resid = T)\n\n\nConstruct VPC, pcVPC, NPDE\nPM_result$valid() or PM_valid$new()\nmakeValid()\n\n\nPlot VPC, pcVPC, NPDE\nPM_valid$plot()\nplot(PMvalid)\n\n\nStepwise covariate regression\nPM_result$step()\nPMstep()\n\n\n\n\n\n\n\n\n\n3.5.3 Other functions\nComparison between the current and the Legacy methods are shown for education.\n\n\n\n\n\n\n\n\nFunction\nR6\nLegacy\n\n\n\n\nCalculate AUC\n$auc() method for PM_result$op/$post/$pop, or PM_sim\nmakeAUC()\n\n\nSimulate\nPM_result$sim() or PM_sim$new()\nSIMrun()\n\n\nProbability of target attainment\nPM_sim$pta() or PM_pta$new()\nmakePTA()\n\n\n\n\n\n\n\n\n\n\n\n\nAgain, all functions have extensive help files and examples which can be examined in R by using the help(command) or ?command syntax.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "workflow.html",
    "href": "workflow.html",
    "title": "2¬† Workflow",
    "section": "",
    "text": "2.1 General Workflow\nThe general Pmetrics workflow is shown in the following diagram.\nflowchart LR\n\nsubgraph RSession[\" \"]\n  direction TB\n  DATA[\"PM_data\"]\n  MODEL[\"PM_model\"]\n  RESULT[\"PM_result\"]\nend\n\nDISK[(\"Hard Drive\")]\n\nDATA --&gt; MODEL\nMODEL -- \"$fit()\" --&gt; RESULT\nRESULT --&gt; MODEL\nDISK -- \"PM_load()\" --&gt; RESULT\nRESULT --&gt; DISK\n\nclassDef blue fill:#2f6db6,stroke:#184a8b,color:#fff;\nclassDef orange fill:#c7662b,stroke:#8a3f18,color:#fff;\nclassDef disk fill:#d2d3d7,stroke:#7f8084,color:#000;\n\nclass DATA,MODEL blue;\nclass RESULT orange;\nclass DISK disk;\n\nstyle RSession fill:#e9f0ff,stroke:#9ab0d6,stroke-width:1px,rx:2,ry:2\nData are combined with a model during a fitting operation to produce results, which are saved to the hard drive for later retrieval and examination. The blue box represents your R script or Quarto document containing R code that you write to perform your analysis.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Workflow</span>"
    ]
  },
  {
    "objectID": "workflow.html#general-workflow",
    "href": "workflow.html#general-workflow",
    "title": "3¬† Workflow",
    "section": "",
    "text": "Create a new directory for your project\nCreate a new R script or Quarto document in that directory\nBuild your project code in that script or document.\nYou can store source data files in a subdirectory, e.g.¬†‚Äúdata‚Äù or ‚Äúsrc‚Äù and the various runs when you fit a model to the data in another subdirectory, e.g.¬†‚ÄúRuns‚Äù.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Workflow</span>"
    ]
  },
  {
    "objectID": "NPAG.html",
    "href": "NPAG.html",
    "title": "6¬† Running NPAG",
    "section": "",
    "text": "First, you must always load the Pmetrics library in your R script or Quarto document.\n\nlibrary(Pmetrics)\n\n\n6.0.1 Working directory\nNext, R and Pmetrics need to know which directory to work in. This is the directory where R expects to find files and where it will save output files. There are two ways to do this.\n\n6.0.1.1 Global working directory change\nYou can set your working directory with the setwd function.\n\nsetwd(\"/path/to/your/project/directory\") # Mac and Linux users\nsetwd(\"C:/path/to/your/project/directory\") # Windows users\n\nWindows users: Make sure that you separate directories with a forward slash ‚Äú/‚Äù or double backslashes ‚Äú\\‚Äù. Unfortunately, Windows is the only OS that uses backslashes ‚Äú‚Äú, so R conforms to Unix/Linux style with the forward slash. If you copy the example below, make sure to change the path to one that exists on your computer.\n\n\n6.0.1.2 Local path specification\nYou can also specify the path in a variable and use it in Pmetrics functions without changing the working directory.\n\nwd &lt;- \"/path/to/your/project/directory\" # Mac and Linux users\nwd &lt;- \"C:/path/to/your/project/directory\" # Windows users\ndat &lt;- PM_data$new(data = file.path(wd, \"data\", \"mydata.csv\"))\n\nüí° The file.path function creates file paths that are compatible with your operating system.\n\n\n\n6.0.2 Workflow\nThe typical workflow for using Pmetrics is as follows:\n\nCreate a PM_data object.\nCreate a PM_model object.\nFit the model to the data with the $fit() method of the model object. This returns a PM_result object, which is also saved to the hard drive and can be loaded later with the PM_load function.\nExamine the results with PM_result methods and functions and revise as needed to improve the model fit. This chiefly means using the $update() method to change the model or manually editing it.\n\n\n\n\n\n\nflowchart LR\n\nsubgraph RSession[\" \"]\n  direction TB\n  DATA[\"PM_data\"]\n  MODEL[\"PM_model\"]\n  RESULT[\"PM_result\"]\nend\n\nDISK[(\"Hard Drive\")]\n\nDATA --&gt; MODEL\nMODEL -- \"$fit()\" --&gt; RESULT\nRESULT -- \"$update()\" --&gt; MODEL\nDISK -- \"PM_load()\" --&gt; RESULT\nRESULT --&gt; DISK\n\nclassDef blue fill:#2f6db6,stroke:#184a8b,color:#fff;\nclassDef orange fill:#c7662b,stroke:#8a3f18,color:#fff;\nclassDef disk fill:#d2d3d7,stroke:#7f8084,color:#000;\n\nclass DATA,MODEL blue;\nclass RESULT orange;\nclass DISK disk;\n\nstyle RSession fill:#e9f0ff,stroke:#9ab0d6,stroke-width:1px,rx:2,ry:2\n\n\n\n\n\n\n\n\n\n6.0.3 Data objects\nPmetrics always needs data and a model to run, so let‚Äôs create a new data object.\n\nexData &lt;- PM_data$new(data = \"Data/src/ex.csv\")\n\n\n\n\n‚îÄ‚îÄ DATA STANDARDIZATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n\nEVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n All observations assumed to be uncensored.\n One or more error coefficients not specified. Error in model object will be used.\n\n\n\n\n\n‚îÄ‚îÄ DATA VALIDATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n\nNo data errors found.\n\n\nPmetrics standardizes the data, checks for errors, and provides an error and attempted fix report fo any found.\nYou can look at a .csv data file directly by opening it in a spreadsheet program like Excel, or a text editor.\nexData is an R6 object, which means that contains both data and methods to process that data.\n\nexData # prints the object, usually to the terminal, but in this case to a rendered \"lite\" spreadsheet\nexData$data # contains your original data\nexData$standard_data # contains the standardized and validated data\nexData$summary() # prints the summary of the data to the terminal\n\nMost Pmetrics objects are R6 objects, so you can use the $ operator to access their data and methods. Many of them have a summary() method that prints a summary of the object to the console and a plot() method that creates a plot of the object. See PM_data for more information on the PM_data class and its methods.\nNote: We recognize that many users are familiar with the ‚ÄúS3 framework‚Äù in R, which uses functions like summary(object) and plot(object). To comply with better programming standards, Pmetrics uses the R6 framework. However, we have provided S3 methods for most functions, so you can use summary(object) and plot(object) if you prefer.\n\n# S3 method to summarize data\nsummary(exData)\n\nPM_data has a plot() method that creates a plot of the data. See plot.PM_data for more information.\n\nexData$plot() \n\n\n\n\n\n\n\n\n\n6.0.4 Model objects\nYou can specify a model by reading a file or directly as a list object in R. We‚Äôll do both.\nThe following code creates the same model as in /src/model.txt file. See further model details on creating models in R compared to text files. The advantage of creating them in R is that one does not need to copy model files into folders to provide necessary inputs.\n\nmod1 &lt;- PM_model$new(\n  pri = list(\n    Ka = ab(0.1, 0.9),\n    Ke = ab(0.001, 0.1),\n    V = ab(30, 120),\n    lag1 = ab(0, 4)\n  ),\n  cov = list(\n    wt = interp(),\n    africa = interp(\"none\"),\n    age = interp(),\n    gender = interp(\"none\"),\n    height = interp()\n  ),\n  eqn = function(){\n    two_comp_bolus\n  },\n  lag = function(){\n    lag[1] = lag1\n  },\n  out = function(){\n  Y[1] = X[2]/V\n  },\n  err = list(\n    proportional(5, c(0.02, 0.05, -0.0002, 0))\n  )\n)\n\n‚Ñπ Compiling model...\n\n\nUsing template path: /Users/mneely/Library/CloudStorage/OneDrive-CHILDRENSHOSPITALLOSANGELES/Documents/LAPK/Development/Pmetrics_rust/inst \n\n\nWhen you execute the above code in your own script or Quarto document, you will see a message indicating that the model has compiled.\n\nmod1 # prints the model object\n\n\n\n\n‚îÄ‚îÄ Model summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n\n\n\n\n‚îÄ‚îÄ Primary Parameters \n\n\nKa: [0.1, 0.9], ~N(0.5, 0.13)\n\n\nKe: [0.001, 0.1], ~N(0.05, 0.02)\n\n\nV: [30, 120], ~N(75, 15)\n\n\nlag1: [0, 4], ~N(2, 0.67)\n\n\n\n\n\n‚îÄ‚îÄ Covariates \n\n\nwt, africa (no interpolation), age, gender (no interpolation), and height\n\n\n\n\n\n‚îÄ‚îÄ Primary Equations \n\n\ntwo_comp_bolus\n\n\n\n\n\n‚îÄ‚îÄ Lag Time \n\n\nlag[1] = lag1\n\n\n\n\n\n‚îÄ‚îÄ Outputs \n\n\nY[1] = X[2]/V\n\n\n\n\n\n‚îÄ‚îÄ Error Model \n\n\nProportional, with initial value of 5 and coefficients 0.02, 0.05, -2e-04, and\n0.\n\n\n\nmod1$plot() \n\n\n\n\n\n\n\n\nWe have another file ‚Äúmodel.txt‚Äù that contains the old representation of the same model we coded above, let‚Äôs take a look at it.\n\nsystem(\"cat Data/src/model.txt\")\n\nYou can also open it in a text editor.\nPM_model$new() also accepts the path to a model file to create the same model using the file.\n\nmod1b &lt;- PM_model$new(\"Data/src/model.txt\")\nmod1b # look at it\n\nTo copy a model use the $clone() method.\n\nmod1b &lt;- mod1$clone()\n\nSimply using mod1b &lt;- mod1 will cause mod1b to be changed if mod1 is changed, as R6 objects use reference semantics. For more details you can refer to Advanced R, Section 14.4.\n\n\n6.0.5 Fit the model to the data\nTo keep everything tidy, we are working in a folder specifically to store the runs. We are specifying the path in the call to $fit() rather than globally changing the working directory.\n\nrun1 &lt;- mod1$fit(data = exData, run = 1, overwrite = TRUE, path = \"Data/Runs\") \n\nThe PM_model class has a $fit() method that fits the model to the data.\nAfter the run is complete the results are returned to the assigned object, here ‚Äòrun1‚Äô. However, if you want to load the results later, you can use the PM_load() function. Runs will be sequentially numbered as /1, /2, /3,‚Ä¶ in your working directory.\n\nrun1 &lt;- PM_load(1, path = \"Data/Runs\") # load the results from run 1 if returning to this script later",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>Running NPAG</span>"
    ]
  },
  {
    "objectID": "examine.html",
    "href": "examine.html",
    "title": "5¬† Examine the results",
    "section": "",
    "text": "Recall that in the previous exercises, we loaded our run results with the following.\n\nrun1 &lt;- PM_load(1, path = \"Data/Runs\")\n\nrun1 is now a PM_result R6 object that contains all the results from the NPAG run. Let‚Äôs dig into it in more detail.\n\n5.0.1 Data\n\n5.0.1.1 Data plots\nYou can plot the original data using R6 with various options. Type ?plot.PM_data in the R console for help.\n\nrun1$data$plot() \n\n\n\n\n\n\n\nHere‚Äôs some nice grouping and coloring. If you use grouping, provide names in group_names and colors/symbols for each group as arguments to marker. Colors of lines will be set to the same as for marker to avoid a mess of colors.\n\nrun1$data$plot(group = \"gender\", group_names = c(\"Female\", \"Male\"), \n  marker = list(color = c(\"red\",\"blue\"), symbol = c(\"circle\",\"triangle-up\"))) \n\n\n\n\n\n\n\nThe next one splits the data by subject but will not render easily in this document. You can interact with it in your own script or Quarto document.\n\nrun1$data$plot(overlay = FALSE, xlim = c(119, 145))\n\nThe following are the older S3 method with plot(...) for the first two examples. You can use R6 or S3 for any Pmetrics object. We will focus on R6 as the more modern way.\n\nplot(run1$data)\n\n\n\n5.0.1.2 Data summaries\nHere‚Äôs a summary of the original data file; ?summary.PM_data for help.\n\nrun1$data$summary()\n\n\n\n\n5.0.2 Observed vs.¬†Predicted (OP)\n\n5.0.2.1 OP plots\nYou can plot observed vs.¬†predicted data. Type ?plot.PMop in the R console for help or check out plot.PM_op.\n\nrun1$op$plot() \n\n\n\n\n\n\n\nBelow, you can see how to change the prediction type, regression line and color, and plotting symbol and color. Most plots in Pmetrics have marker and line list arguments to customize the appearance of the plotting symbols and lines.\n\nrun1$op$plot(pred.type = \"pop\")\nrun1$op$plot(line = list(lm = FALSE, loess = list(color = \"red\")), marker = list(symbol = 3, color = \"green\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n5.0.2.2 OP summaries\nGet a summary with bias and imprecision of the population predictions; ?summary.PM_op in the console or summary.PM_op for more information. The default pred.type is ‚Äúpost‚Äù, which are the predictions based on the full Bayesian posterior distribution of parameter values for an individual. The predictions are the weighted mean or median (controlled by the icen argument in all Pmetrics functions) of the predictions from each support point in the individual‚Äôs Bayesian posterior, joint probability parameter distribution, i.e.¬†the support points in the posterior. Here we will look at the population predictions based on the means of the parameter values.\n\nrun1$op$summary(pred.type = \"pop\", icen = \"mean\")\n\n\n\n\n\nSince neither ‚Äúpop‚Äù nor ‚Äúmean‚Äù are the defaults, we have to specify them. We can also use the S3 method for the same summary below.\n\nsummary(run1$op, pred.type = \"pop\", icen = \"mean\") # S3 method\n\nAs with any object in Pmetrics, the PM_op R6 object has fields and methods. Fields contain data and methods are functions that act on the data. All fields and methods are accessed with $ added to the name of the object. For example, in a PM_op object and most other Pmetrics objects, the raw data can be accessed via the $data field.\n\nrun1$op$data\n\nHaving the raw data provides a data frame compatible with any R function, particularly those from Tidyverse (see https://www.tidyverse.org/), including piping (%&gt;%). If you‚Äôre not familiar with the pipe operator, see this article. We strongly recommend Tidvyerse for data manipulation and visualization in R, and Pmetrics works well with it. See R for Data Science for more information.\nThis allows pre-processing in ways more flexible than the default plot method.\n\nlibrary(tidyverse)\nrun1$op$data %&gt;% plot()\nrun1$op$data %&gt;%\n  filter(pred &gt; 5) %&gt;%\n  filter(pred &lt; 10) %&gt;%\n  summary()\n\nSee a header with the first 10 rows of the op object:\n\nhead(run1$op$data, 10)\n\n\n\n\n5.0.3 Final population joint density\n\n5.0.3.1 Final plots\nPlot the final population joint density. Type ?plot.PM_final in the R console for help.\n\nrun1$final$plot()\n\n# alternate methods with same result\nrun1$final$data %&gt;% plot() # tidyverse style\nplot(run1$final) # S3 method\nplot(run1$final$data) # S3 method\n\n\n\n\n\n\n\nYou can add a kernel density curve.\n\nrun1$final$plot(line = list(color = \"red\"))\n\n\n\n\n\n\n\nIt is possible to make a bivariate plot. Plotting formulae in R are of the form y~x\n\nrun1$final$plot(ke ~ v,\n  marker = list(color = \"red\", symbol = \"diamond\"))\n\n\n\n\n\n\n\n\n\n5.0.3.2 Final summaries\nSee a summary with confidence intervals around the medians and the Median Absolute Weighted Difference (MAWD); ?summary.PM_final for help and further explanation.\n\nrun1$final$summary()\n\nThe original final object can be accessed with the $data field.\n\nrun1$final$data\nnames(run1$final$data)\n\nSee the population points:\n\nrun1$final$popPoints\n\n# A tibble: 19 √ó 5\n      ka     ke     v   tlag1   prob\n   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;\n 1 0.899 0.0340  74.4 2.01    0.101 \n 2 0.898 0.0433 108.  2.09    0.0500\n 3 0.897 0.0608  32.5 3.14    0.0500\n 4 0.899 0.0564 120.  0.678   0.0502\n 5 0.363 0.0749  68.4 0.869   0.0500\n 6 0.805 0.0755  60.8 1.09    0.0500\n 7 0.899 0.0278  63.7 1.75    0.0506\n 8 0.690 0.0371  85.1 0.644   0.0504\n 9 0.102 0.0642 119.  0.00843 0.0498\n10 0.717 0.0590  64.8 0.821   0.0497\n11 0.364 0.0278  58.9 0.458   0.0494\n12 0.549 0.0450 114.  0.316   0.0521\n13 0.694 0.0456  97.9 0.853   0.0497\n14 0.748 0.0291  95.9 1.39    0.0502\n15 0.866 0.0331  74.4 1.11    0.0484\n16 0.747 0.0397 120.  0.00315 0.0485\n17 0.437 0.0698  43.2 3.99    0.0568\n18 0.727 0.0578  53.3 3.04    0.0149\n19 0.725 0.0578  53.3 3.04    0.0783\n\n\nOr drill down one more level into the raw data. The $final$popPoints field above pulls its information from the $final$data$popPoints field below, but is provided as a simpler way to access the population points.\n\nrun1$final$data$popPoints\n\nSee the population mean parameter values:\n\nrun1$final$popMean\n\n# A tibble: 1 √ó 4\n     ka     ke     v tlag1\n  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 0.694 0.0487  79.0  1.48\n\n\n\n\n\n5.0.4 Cycle information\n\n5.0.4.1 Cycle plots\nPlot cycle information; type ?plot.PM_cycle in the R console for help.\n\nrun1$cycle$plot()\n\n\n\n\n\n\n\n\n\n5.0.4.2 Cycle summaries\nSummarize the cycle information; ?summary.PM_cycle for help.\n\nrun1$cycle$summary()\n\n# alternatives\nrun1$cycle$data %&gt;% summary() # tidyverse style\nsummary(run1$cycle) # S3 method\nsummary(run1$cycle$data) # S3 method\n\n\n\n\n\n\n‚îÄ‚îÄ Cycle Summary ‚îÄ‚îÄ\n\n\n\n\n\nCycle number: 100 of 100\n\n\nStatus: Maximum cycles reached\n\n\nLog-likelihood: 440.985\n\n\nAIC:: 448.985\n\n\nBIC: 452.968\n\n\nOuteq 1: Gamma = 2.39\n\n\n\n\n\n‚îÄ‚îÄ Normalized parameter values: \n\n\n# A tibble: 3 √ó 6\n  cycle    ka    ke     v tlag1 stat  \n  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; \n1   100  1.14 0.978 0.975 0.931 mean  \n2   100  1.10 0.622 1.83  1.41  sd    \n3   100  1.13 1     0.92  0.865 median\n\n\n\n\n\n5.0.5 Covariate information\n\n5.0.5.1 Covariate plots\nPlot covariate information; type ?plot.PM_cov in the R console for help. Recall that plotting formulae in R are of the form y~x.\n\nrun1$cov$plot(v ~ wt)\n\n\n\n\n\n\n\nYou can also use the raw data in the $data field to make plots with other R functions, including those from Tidyverse. Here we will filter the data for age &gt; 25 and then plot volume vs.¬†weight.\n\nrun1$cov$data %&gt;%\n  filter(age &gt; 25) %&gt;%\n  plot(v ~ wt)\n\nChange the formatting of the plot with the line and marker list arguments.\n\nrun1$cov$plot(ke ~ age, line = list(loess = FALSE, lm = list(color = \"red\")),\n               marker = list(symbol = 3))\n\n\n\n\n\n\n\nAnother plot with mean Bayesian posterior parameter and covariate values‚Ä¶remember the icen argument?\n\nrun1$cov$plot(v ~ wt, icen = \"mean\")\n\n\n\n\n\n\n\nWhen time is the x variable, the y variable is aggregated by subject. In R plot formulae, calculations on the fly can be included using the I() function.\n\nrun1$cov$plot(I(v * wt) ~ time)\n\n\n\n\n\n\n\nThe above plots the product of volume and weight vs.¬†time for each subject.\n\n\n5.0.5.2 Covariate summaries\nJust as you have the option to plot by mean covariate and posterior parameter values, you can summarize with means; ?summary.PM_cov for help.\n\nrun1$cov$summary(icen = \"mean\")\n\n# A tibble: 20 √ó 11\n      id    ka     ke     v  tlag1 africa   age gender height    wt icen \n   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;\n 1     1 0.370 0.0278  59.0 0.473       1    21      1    160  46.7 mean \n 2     2 0.739 0.0399 120.  0.0155      1    30      1    174  66.5 mean \n 3     3 0.898 0.0433 108.  2.09        1    24      0    164  46.7 mean \n 4     4 0.899 0.0564 120.  0.678       1    25      1    165  50.8 mean \n 5     5 0.104 0.0642 119.  0.0105      1    22      1    181  65.8 mean \n 6     6 0.898 0.0340  74.4 2.01        1    23      1    177  65   mean \n 7     7 0.706 0.0586  52.7 3.11        1    27      0    161  51.7 mean \n 8     8 0.898 0.0340  74.4 2.01        1    22      1    163  51.2 mean \n 9     9 0.692 0.0456  98.1 0.845       1    23      1    174  55   mean \n10    10 0.717 0.0590  64.9 0.821       1    32      1    163  52.1 mean \n11    11 0.363 0.0749  68.4 0.869       1    34      1    165  56.5 mean \n12    12 0.749 0.0292  95.5 1.39        1    54      0    160  47.9 mean \n13    13 0.452 0.0692  43.7 3.94        1    24      1    180  60.5 mean \n14    14 0.552 0.0449 114.  0.315       1    26      1    174  59.2 mean \n15    15 0.864 0.0330  74.8 1.13        1    19      0    150  43   mean \n16    16 0.690 0.0371  85.2 0.646       1    25      1    173  64.4 mean \n17    17 0.805 0.0755  60.8 1.09        1    23      1    170  54.8 mean \n18    18 0.899 0.0278  63.7 1.74        1    20      0    164  44.3 mean \n19    19 0.897 0.0608  32.5 3.14        1    36      1    168  50   mean \n20    20 0.691 0.0592  52.1 3.16        1    31      1    170  59   mean \n\n\nThe run1$cov object looks like a data frame, but is really an R6 PM_cov object whose $print() method returns a data frame. You can access the raw data with the $data field, which is truly a data frame.\n\nrun1$cov$data[, 1:3] # for example\nrun1$cov$data %&gt;% filter(gender == 1) %&gt;% summary() # using Tidyverse\n\nThis returns a data frame with the means of the individual‚Äôs covariates over the observation period and the mean of the Bayesian posterior parameter values.\nWhen trying to find covariate-parameter relationships, it is convenient to examine at all possible covariate-parameter relationships by multiple linear regression with forward and backward elimination - type ?PM_step in the R console for help or see PM_step.\n\nrun1$step()\n\n       age gender height    wt\nka      NA     NA     NA    NA\nke      NA  0.047  0.076 0.105\nv       NA     NA  0.181 0.116\ntlag1   NA  0.162     NA    NA\nafrica  NA     NA     NA    NA\n\n\n‚Ä¶or on the cov object directly.\n\nrun1$cov$step()\n\nicen works here too.\n\nrun1$step(icen = \"mean\")\n\nIf you wish to see P values for forward elimination only:\n\nrun1$step(direction = \"forward\")\n\n         age gender height    wt\nka     0.841  0.519  0.257 0.267\nke     0.920  0.127  0.236 0.281\nv      0.784  0.694  0.084 0.149\ntlag1  0.684  0.287  0.238 0.624\nafrica    NA     NA     NA    NA",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Examine the results</span>"
    ]
  },
  {
    "objectID": "NPAG_cov.html",
    "href": "NPAG_cov.html",
    "title": "6¬† NPAG with covariates",
    "section": "",
    "text": "Let‚Äôs create another run object, this time using a model that include covariates.\nFirst clone mod1.\n\nmod2 &lt;- mod1$clone()\n\nThen update it to add a variable V0, or volume that depends on weight. Remove V. Note that updating changes the object in place, so we don‚Äôt have to re-assign it back to mod2, i.e.¬†we don‚Äôt need mod2 &lt;- mod2$update(...), although if you forget, it will work the same. Note that we also have to use the sec block to let Pmetrics know how to calculate V based on V0 and WT (weight). Here we normalize weight to the population mean of 55 kg.\n\nmod2 &lt;- mod2$update(\n  pri = list(\n    v0 = ab(30, 120),\n    v = NULL\n  ),\n  sec = function(x) {\n    v = v0*(wt/70)\n  }\n)\n\n‚Ñπ Compiling model...\n\n\nUsing template path: /Users/mneely/Library/CloudStorage/OneDrive-CHILDRENSHOSPITALLOSANGELES/Documents/LAPK/Development/Pmetrics_rust/inst \n\n\nNow, run that new model.\n\nrun2 &lt;- mod2$fit(data = exData, run = 2, path = \"Data/Runs\", overwrite = TRUE)\n\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 527.0641\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 499.8528\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 489.4649\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 485.8304\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 484.0783\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 483.2585\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 482.1890\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 482.1890\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 473.0736\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 470.6781\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 469.1795\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 467.8819\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 467.7910\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 467.7910\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 464.3140\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 463.2304\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 462.8099\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 462.8063\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 462.8063\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 462.1462\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 461.3525\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 461.1232\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 461.0404\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 461.0206\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 461.0206\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 460.4285\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 460.0191\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.6912\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.4123\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.3489\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.3085\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2826\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2738\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2645\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2514\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2382\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2285\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2233\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2121\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.2000\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1854\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1664\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1515\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1400\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1322\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1280\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1274\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 459.1274\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 458.9680\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 458.5554\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 458.3744\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 458.1497\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 458.0299\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.8607\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.6091\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.5483\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.4484\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.3799\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.3003\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.2423\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.1790\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.0894\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.0678\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 457.0493\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.9887\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.9540\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.9427\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.8601\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.8469\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.8326\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.7597\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.7433\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.6816\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.6633\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.6437\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.5905\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.5705\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.5492\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.5032\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.4814\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.4598\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.4196\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.3951\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.3742\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.3513\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.3128\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.2900\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.2697\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.2342\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.2092\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.1873\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.1686\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.1316\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.1078\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.0875\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.0707\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.0515\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 456.0095\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 455.9907\n[00h 00m 00s] [\u001b[32mINFO\u001b[0m] Objective function = 455.9758\n[00h 00m 00s] [\u001b[33mWARN\u001b[0m] Maximum number of cycles reached\n\n\n\n\n\n‚îÄ‚îÄ Notes: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n\n‚Ä¢ Recommend increasing `points` to at least 180 to ensure adequate coverage of\nparameter space.\n\n\n‚Ä¢ Run results were saved in folder\n''/Users/mneely/Library/CloudStorage/OneDrive-CHILDRENSHOSPITALLOSANGELES/Documents/LAPK/Development/Tutorial/Data/Runs/2/outputs''\n\n\n‚Ä¢ Report could not be generated.\n\n\nRight after the run, the results are in run2, but for future loading if you return to your script later, you can load it with PM_load().\n\nrun2 &lt;- PM_load(2)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>6</span>¬† <span class='chapter-title'>NPAG with covariates</span>"
    ]
  },
  {
    "objectID": "Compare.html",
    "href": "Compare.html",
    "title": "7¬† Comparing models",
    "section": "",
    "text": "Let‚Äôs compare model 1 and model 2. You can compare any number of models. Type ?PM_compare for help. All models must already be loaded either with PM_load or assigning the result of $fit, e.g., run1 &lt;- mod1$fit(...).\n\nPM_compare(run1, run2)\n\nThis will open an html window in your browser with detailed comparisons between the models.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>7</span>¬† <span class='chapter-title'>Comparing models</span>"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Learn Pmetrics",
    "section": "",
    "text": "0.1 Disclaimer\nThank you for your interest in Pmetrics! This online book provides instructions and examples to assist users of the Pmetrics R package, by the Laboratory of Applied Pharmacokinetics and Bioinformatics at the Saban Research Institute, Children‚Äôs Hospital Los Angeles, and the Department of Pediatrics, Keck School of Medicine, University of Southern California. Please see our website at http://www.lapk.org for more information.\nYou, the user, assume all responsibility for acting on the results obtained from Pmetrics. The Laboratory of Applied Pharmacokinetics and Bioinformatics (LAPKB), members and consultants to LAPKB, and Children‚Äôs Hospital Los Angeles and the University of Southern California and their employees assume no liability whatsoever. Your use of the package constitutes your agreement to this provision.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#r6-architecture",
    "href": "index.html#r6-architecture",
    "title": "Learn Pmetrics",
    "section": "0.2 R6 architecture",
    "text": "0.2 R6 architecture\nAs of v. 2.0, Pmetrics uses an ‚ÄúR6‚Äù architecture less dependent on reading and writing files, preserving hard drive space and speeding execution, since file I/O is slow. The goal is to simplfy work within a session by eliminating the need to repeatedly copy and paste files from one folder to the next whenever a new fit is executed. Storing critical objects in memory means they can be used without accessing files.\nHowever, data and model files are still used for longer term storage and preserving work from one session to another. The format of those files, both data and model, will be familiar to long term Pmetrics users.\nData files are generally .csv and the format is detailed in the chapter on data. A model can be read from a text file or can be defined directly in R. The easiest way to accomplish this is with our model builder app. Whether choosing to define models in R, with the builder app, or in a .txt file, details can be found in models.\nTips for using this guide.\n\nItems that are hyperlinked can be selected to cross reference within this manual or link to external sites.\nItems correspond to inline examples of R code, which are not evaluated in this document, but serve as templates for what may be typed into your R console or script. They may not necessarily be executable if typed verbatim.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#disclaimer",
    "href": "index.html#disclaimer",
    "title": "Learn Pmetrics",
    "section": "0.3 Disclaimer",
    "text": "0.3 Disclaimer\nYou, the user, assume all responsibility for acting on the results obtained from Pmetrics. The Laboratory of Applied Pharmacokinetics and Bioinformatics (LAPKB), members and consultants to LAPKB, and Children‚Äôs Hospital Los Angeles and the University of Southern California and their employees assume no liability whatsoever. Your use of the package constitutes your agreement to this provision.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#installing-pmetrics",
    "href": "index.html#installing-pmetrics",
    "title": "Learn Pmetrics",
    "section": "0.2 Installing Pmetrics",
    "text": "0.2 Installing Pmetrics\nPmetrics and all required components will run under MacOS (Unix), Windows, and Linux. Instructions on obtaining and installing the package are in the README section of our source code repository in GitHub.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#what-this-guide-is-not",
    "href": "index.html#what-this-guide-is-not",
    "title": "Learn Pmetrics",
    "section": "0.3 What This Guide Is Not",
    "text": "0.3 What This Guide Is Not\nWe assume that the user has familiarity with population modeling and R, and thus this manual is not a tutorial for basic concepts and techniques in either domain. We have tried to make the R code simple, regular and well documented. A very good free online resource for learning the basics of R can be found at Stat Methods. However, there are a number of other free or low-cost online resources which you can find with a simple or AI-assisted web search.\nWe recognize that initial use of a new software package can be complex, so please feel free to contact us at any time, preferably through the Pmetrics Disussions. You can report issues online as well.\nThis manual is also not intended to be a theoretical treatise on the algorithms Pmetrics uses. For that, the user is directed to our website.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#getting-help-and-updates",
    "href": "index.html#getting-help-and-updates",
    "title": "Learn Pmetrics",
    "section": "0.4 Getting Help and Updates",
    "text": "0.4 Getting Help and Updates\nWithin R, you can use help(\"command\") or more simply just ?command in the R console to see detailed help files for any Pmetrics command. Many commands have examples included in this documentation and you can execute the examples with example(command).\nYou can also type PM_manual() to launch this website from within Pmetrics.\nPmetrics will check for updates automatically every time you load it with library(Pmetrics) and you are connected to the internet. If an update is available, it will provide a brief message to inform you. You can then reinstall the package.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#examples-and-exercises",
    "href": "index.html#examples-and-exercises",
    "title": "Learn Pmetrics",
    "section": "0.5 Examples and Exercises",
    "text": "0.5 Examples and Exercises\nIncluded in this book are numerous code examples and exercises that will help you learn how to use Pmetrics for R. They are designed to be read in sequence.\n\nItems that are hyperlinked can be selected to cross reference within this manual or link to external sites.\nItems correspond to inline examples of R code, which are not evaluated in this document, but serve as templates for what may be typed into your R console or script. They may not necessarily be executable if typed verbatim.\nWe have designed these pages with the idea that you can copy and paste the code chunks into your own scripts or Quarto documents to see how they work. You can hover over the code chunks to see a copy icon. Click that to copy the code to your clipboard so you can paste it into your own script or document. Alternatively, you can click the Copy all code button at the top right of every page to copy all the code chunks on that page to your clipboard.\n\nNote: In many cases, we do not evaluate the code chunks because the ouput is too long, so you will need to run them in your own script or document.\n\n# Hover over the code chunk to see the copy icon.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#scripting",
    "href": "index.html#scripting",
    "title": "Learn Pmetrics",
    "section": "0.6 Scripting",
    "text": "0.6 Scripting\nYou can use either an R script or a Quarto document to paste code from these pages or to write your own code. R scripts have the advantage of being simple and easy to use. Quarto documents have the advantage of being able to combine code with formatted text, images, links, etc. You can use either method to work with Pmetrics. Choose the one that works best for you.\n\n0.6.1 R script\n\nCreate a new script with File -&gt; New File -&gt; R Script (Rstudio) or R File (Positron).\nSave the script in your project directory with a name like ‚ÄúLearn.R‚Äù.\nYou can then copy and paste code chunks from these pages into your script and run them line by line or all at once.\nIt is useful to annotate your code with comments like the one above so you can remember what you did later.\n\nHere‚Äôs a toy example of an R script.\n\n# This is a comment in R. It starts with a # symbol.\n# Anything other than a comment should be R code.\na &lt;- 1 + 1\nprint(a) # This will print the value of a to the console.\n\n\n\n0.6.2 Quarto document\n\nCreate a new document with File -&gt; New File -&gt; Quarto Document (Rstudio/Positron).\nUse markdown to add headings, links, images, etc.\nInsert R chunks to paste copied code or write your own.\nExecute code from the chunks.\nRender the document to create a nicely formatted output in HTML, PDF, or Word format.\nSee Quarto documentation for more information.\n\nHere‚Äôs a toy example of a Quarto document. It mixes text formatted in markdown and R code chunks.\n---\ntitle: \"My Project\"\nformat: html\n---\n\n## Introduction\nThis is my first Quarto document. Below is some R code.\n\n```{r}\n# this is an R code chunk\nb &lt;- 2 + 2\nprint(b)\n```\n\nYou can see that the value of b is printed above.\n\nWhen rendered, the above will look like this:",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#my-project",
    "href": "index.html#my-project",
    "title": "Learn Pmetrics",
    "section": "My Project",
    "text": "My Project\n\nIntroduction\nThis is my first Quarto document. Below is some R code.\n\n# this is an R code chunk\nb &lt;- 2 + 2\nprint(b)\n\n[1] 4\n\n\nYou can see that the value of b is printed above.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>1</span>¬† <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "workflow.html#scripting",
    "href": "workflow.html#scripting",
    "title": "2¬† Workflow",
    "section": "2.2 Scripting",
    "text": "2.2 Scripting\nYou can use either an R script or a Quarto document to paste code from these pages or to write your own code. R scripts have the advantage of being simple and easy to use. Quarto documents have the advantage of being able to combine code with formatted text, images, links, etc. You can use either method to work with Pmetrics. Choose the one that works best for you.\n\n2.2.1 R script\n\nCreate a new script with File -&gt; New File -&gt; R Script (Rstudio) or R File (Positron).\nSave the script in your project directory with a name like ‚ÄúLearn.R‚Äù.\nYou can then copy and paste code chunks from these pages into your script and run them line by line or all at once.\nIt is useful to annotate your code with comments like the one above so you can remember what you did later.\n\nHere‚Äôs a toy example of an R script.\n\n# This is a comment in R. It starts with a # symbol.\n# Anything other than a comment should be R code.\na &lt;- 1 + 1\nprint(a) # This will print the value of a to the console.\n\n\n\n2.2.2 Quarto document\n\nCreate a new document with File -&gt; New File -&gt; Quarto Document (Rstudio/Positron).\nUse markdown to add headings, links, images, etc.\nInsert R chunks to paste copied code or write your own.\nExecute code from the chunks.\nRender the document to create a nicely formatted output in HTML, PDF, or Word format.\nSee Quarto documentation for more information.\n\nHere‚Äôs a toy example of a Quarto document. It mixes text formatted in markdown and R code chunks.\n---\ntitle: \"My Project\"\nformat: html\n---\n\n## Introduction\nThis is my first Quarto document. Below is some R code.\n\n```{r}\n# this is an R code chunk\nb &lt;- 2 + 2\nprint(b)\n```\n\nYou can see that the value of b is printed above.\n\nWhen rendered, the above will look like this:",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Workflow</span>"
    ]
  },
  {
    "objectID": "workflow.html#my-project",
    "href": "workflow.html#my-project",
    "title": "2¬† Workflow",
    "section": "My Project",
    "text": "My Project\n\nIntroduction\nThis is my first Quarto document. Below is some R code.\n\n# this is an R code chunk\nb &lt;- 2 + 2\nprint(b)\n\n[1] 4\n\n\nYou can see that the value of b is printed above.\n\n\n2.2.3 Data and model objects\nYou supply the data and model objects. These can come from the hard drive or directly defined within R. We devote whole chapters in this book to creating these objects, which are at the heart of Pmetrics, but we provide a sneak preview here to illustrate the workflow.\nThe model file is created in R using the PM_model$new() function and the data file by PM_data$new(). When combined using the $fit() method on the compiled model, the analysis is executed. At the end of the run, the hard drive will contain a new numerically named folder, e.g., 1, 2, 3, ‚Ä¶, that contains the files which can be loaded into R subsequently using PM_load(x), replacing x with the folder number. PM_load() is an alias for PM_result$new() because it creates a new PM_result() object which contains all the results of a run, and has many assciated methods attached to it for plotting, simulating, etc.\nTo change model structure between fits, update the model file or the R code that defines the model. If continuing a previous run that did not end, simply use $fit() and specify the run number you wish to continue as the prior argument to $fit(). These scenarios are illustrated below.\n\n# Run 1 - ensure the data, model files are in the working directory\ndat1 &lt;- PM_data$new(\"data.csv\")\nmod1 &lt;- PM_model$new(\"model.txt\")\n\n# alternatively, define model in R directly\nmod1 &lt;- PM_model$new(\n  pri = list(\n    ke = ab(0, 5),\n    v = ab(10, 200)\n  ),\n  eqn = function(){\n    one_comp_iv\n  },\n  out = function(){\n    Y[1] = X[2]/v\n  },\n  err = list(\n    proportional(5, c(0.02, 0.05, -0.0002, 0))\n  )\n)\n\n# now, fit the model to the data\nrun1 &lt;- mod1$fit(dat1) # this is a PM_result object\n\nrun1 &lt;- PM_load(1) # if returning to script later, use this to load from hard drive\n\n# Run 2 - update Ke range\nmod2 &lt;- PM_model$new(\"model2.txt\") # updated model file\n\n# or in R directly\nmod2 &lt;- PM_model$new(\n  pri = list(\n    ke = ab(0, 2), # changed upper limit\n    v0 = ab(10, 200)\n  ),\n  cov = list(\n    wt = interp(), # add covariates in the data\n    age = interp()\n  ),\n  eqn = function(){\n    one_comp_iv\n  },\n  out = function(){\n    v = v0 * (wt/70) # define volume in terms of weight\n    Y[1] = X[2]/v\n  },\n  err = list(\n    proportional(5, c(0.02, 0.05, -0.0002, 0))\n  )\n)\n\n# now, fit the updated model to the same data\nrun2 &lt;- mod2$fit(dat1)\n\n\n# Run 3 - continue run 2\nrun3 &lt;- mod2$fit(data = dat1, prior = 2)\n\nThe great advantage of R6 over Legacy is that in R6, you no longer have to spend time copying files from prior run folders, modifying them, and ensuring that they are in the working directory. After the initial creation of the data and model objects, everything can be done in R from memory, although results are still saved to hard drive for later retrieval.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Workflow</span>"
    ]
  },
  {
    "objectID": "workflow.html#components-of-a-new-project",
    "href": "workflow.html#components-of-a-new-project",
    "title": "2¬† Workflow",
    "section": "2.2 Components of a new project",
    "text": "2.2 Components of a new project\nTo implement the above workflow when you work on a new project, you will typically do the following:\n\nCreate a new directory for your project\nCreate a new R script or Quarto document in that directory\nBuild your project code in that script or document.\nYou can store source data files in a subdirectory, e.g.¬†‚Äúdata‚Äù or ‚Äúsrc‚Äù and the various runs when you fit a model to the data in another subdirectory, e.g.¬†‚ÄúRuns‚Äù.\n\n\n2.2.1 Creating a new project directory\nIf you have loaded Pmetrics already with library(Pmetrics), the command PM_tree() will create a project folder with subfolders for you. To learn more about this function or any other in R, you can get help by typing ?function_name in the console.\n\nPM_tree(\"MyProject\") # creates a new project called \"MyProject\" in your current working directory\nPM_tree(\"MyProject\", path = \"somewhere\") # creates a new project called \"MyProject\" in the \"somewhere\" directory\n\n\n\n2.2.2 Scripting\nYou can use either an R script or a Quarto document to paste code from these pages or to write your own code. R scripts have the advantage of being simple and easy to use. Quarto documents have the advantage of being able to combine code with formatted text, images, links, etc. You can use either method to work with Pmetrics. Choose the one that works best for you.\n\n2.2.2.1 R script\n\nCreate a new script with File -&gt; New File -&gt; R Script (Rstudio) or R File (Positron).\nSave the script in your project directory with a name like ‚ÄúLearn.R‚Äù.\nYou can then copy and paste code chunks from these pages into your script and run them line by line or all at once.\nIt is useful to annotate your code with comments like the one above so you can remember what you did later.\n\nHere‚Äôs a toy example of an R script.\n\n# This is a comment in R. It starts with a # symbol.\n# Anything other than a comment should be R code.\na &lt;- 1 + 1\nprint(a) # This will print the value of a to the console.\n\n\n\n2.2.2.2 Quarto document\n\nCreate a new document with File -&gt; New File -&gt; Quarto Document (Rstudio/Positron).\nUse markdown to add headings, links, images, etc.\nInsert R chunks to paste copied code or write your own.\nExecute code from the chunks.\nRender the document to create a nicely formatted output in HTML, PDF, or Word format.\nSee Quarto documentation for more information.\n\nHere‚Äôs a toy example of a Quarto document. It mixes text formatted in markdown and R code chunks.\n---\ntitle: \"My Project\"\nformat: html\n---\n\n## Introduction\nThis is my first Quarto document. Below is some R code.\n\n```{r}\n# this is an R code chunk\nb &lt;- 2 + 2\nprint(b)\n```\n\nYou can see that the value of b is printed above.\n\nWhen rendered, the above will look like this:",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>2</span>¬† <span class='chapter-title'>Workflow</span>"
    ]
  },
  {
    "objectID": "overview.html#rust-as-the-backend",
    "href": "overview.html#rust-as-the-backend",
    "title": "3¬† Overview",
    "section": "3.3 Rust as the backend",
    "text": "3.3 Rust as the backend\nAs of v. 3.0, Pmetrics uses Rust for the core of the package and no longer uses Fortran. This is for several reasons, including the fact that Rust is a modern programming language that is more efficient and easier to maintain than Fortran. Rust is memory safe, which means that it prevents common programming errors that can lead to memory leaks and crashes. This makes it a more reliable choice for high-performance computing tasks. Additionally, Rust has a growing ecosystem of libraries and tools that make it easier to work with data and perform complex computations and a more flexible choice for a wide range of applications.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>3</span>¬† <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "models.html",
    "href": "models.html",
    "title": "5¬† Models",
    "section": "",
    "text": "5.1 Introduction\nPM_model objects are one of two fundamental objects in Pmetrics, along with PM_data objects. Defining a PM_model allows for fitting it to the data via the $fit() method to conduct a population analysis, i.e.¬†estimating the probability distribution of model equation parameter values in the population.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Models</span>"
    ]
  },
  {
    "objectID": "models.html#creating-models",
    "href": "models.html#creating-models",
    "title": "5¬† Models",
    "section": "5.2 Creating Models",
    "text": "5.2 Creating Models\nThere are three pathways to creating models in Pmetrics.\n\nUse the new Pmetrics Model Builder app, coming soon. The Shiny app is retired.\nWrite a model list in R\nLoad an existing model text file\n\nEach of these use sections to define the model. In the app, the sections correspond to tabs. In the list, they are named elements. In the model file, they are code blocks delimited by ‚Äú#‚Äù and the name of the block. The sections are largely the same across the three model pathways, and we‚Äôll cover the details in this document.\n\n5.2.1 Create a model with the app\nComing soon.\n\n\n\n5.2.2 Create a model as a list in R\nYou can write a Pmetrics model list in R. Blocks in the model files which are delimited with the ‚Äú#‚Äù character in the file become elements of the list in R6.  Once in R, PM_model list objects can be updated using the $update() method.\nThe list elements are the building blocks for the model. Building blocks are of two types:\n\nBlock elements: Lists define primary parameters, covariates, and error models. These portions of the model are lists of specific creator functions and no additional R code is permissible. They take this form:\n\n\nblock_name = list( \n    var1 = creator(),   \n    var2 = creator(),\n    ... # more creators\n) # close the list\n\nNote the comma separating the creator functions, list( to open the list and ) to close the list. Names are case-insensitive and are converted to lowercase for Rust.\n\nBlock elements: functions define the other parts of the model, including secondary (global) equations, model equations (e.g.¬†ODEs), lag time, bioavailability, initial conditions, and outputs. These parts of the model are defined as R functions without arguments, but whose body contains any permissible R code.\n\n\nblock_name = function() { \n\n          # any valid R code \n          # can use primary or secondary parameters and covariates\n          # lines are not separated by commas\n      \n} # end function and block\n\nNote the absence of arguments between the (), the opening curly brace { to start the function body and the closing curly brace ‚Äú}‚Äù to end the body. Again, all R code will be converted to lowercase prior to translation into Rust.\nImportant: All models must have pri, eqn, out, and err blocks.\n\n\n5.2.3 Model Files\nThe format of the .txt model file has been mostly unchanged since Pmetrics 0.4, and they are created by hand.  Once you have a file, it can be loaded in to R with PM_model$new(\"file\").\n\nmod1 &lt;- PM_model$new(\"model.txt\") \n# assumes model.txt is in working directory\n# check with list.files() and/or getwd()\n\nSaved models are only text files. You can write files directly yourself, although it is easier and more stable to use the model building app. We will review the format of the files in detail.\nNaming your model files. The default model file name is ‚Äúmodel.txt,‚Äù but you can call them whatever you wish. When you use a model file in a $fit() method, at the end of the run, your original model file will be left where it is, but a copy called ‚Äúgenmodel.txt‚Äù will be in the /inputs subfolder of the run folder.\nStructure of model files. The model file is a text file with up to 11 blocks, each marked by ‚Äú#‚Äù followed by a header tag. For each header, only the capital letters are required for recognition by Pmetrics. The blocks can be in any order, and header names are case-insensitive (i.e.¬†the capitalization here is just to show which letters are required). We include a complete example.\nComments: You can insert comments into your model text file by starting a line with a capital ‚ÄúC‚Äù followed by a space. These lines will be removed/ignored in the final Rust code.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Models</span>"
    ]
  },
  {
    "objectID": "models.html#model-blocks",
    "href": "models.html#model-blocks",
    "title": "5¬† Models",
    "section": "5.3 Model Blocks",
    "text": "5.3 Model Blocks\n\nBlocks common to all the model building pathways include the following. The capital letters are the shorthand way to designate the blocks in the model text files or in the R list format.\n\nPRImary variables\nCOVariates\nSECcondary variables\nINItial conditions\nFA (bioavailability)\nLAG time\nEQuatioNs\nOUTputs\nERRors\n\n\n5.3.1 Model Library\n\nYou can access the Pmetrics Model Library programmatically using the model_lib function. This function returns a data frame of available models with their characteristics, including the model name to be used in the EQN block, number of compartments, number of inputs and outputs, and a brief description.\nAll of the models are pre-loaded as R6 objects. You can get details of the model by simply typing its primary name from the table into the console. For example:\n\ntwo_comp_bolus\n\n\n\n5.3.2 PRImary\n\n5.3.2.1 App\nComing soon.\n\n\n\n5.3.2.2 List\nPrimary variables are defined in a list(). The list is named ‚Äúpri‚Äù, and is comprised of named elements which are the parameters, and the creator function to define each parameter, one parameter to a line.\nThe two creator functions for primary parameters are ab and msd. Choose one for each parameter. The first defines the absolute search space for that parameter for NPAG/NPOD, i.e., the range. msd is the companion function that specifies the range using a mean and standard deviation (SD), assuming the mean is the midpoint of the range, and the SD equals 1/6th of the range, i.3., there are 3 SD above and below the mean, covering 99.7% of the prior distribution.      \n\n\n\n\nmod &lt;- PM_model$new(\n  pri = list(\n    Ke = ab(0, 5), # mean will be 2.5, SD = 5/6 = 0.83\n    V = msd(100, 20) # range will be 100 ¬± 3*20, i.e. [40, 160]\n  )\n)\n\n\n\n5.3.2.3 File\nPrimary variables are a list of variable names, one name to a line. On each line, following the variable name, is the range for the parameter that defines the search space. These ranges behave slightly differently for NPAG and the simulator.\n\nFor all engines, the format of the limits is min, max.\nFor NPAG/NPOD, when min, max limits are specified, they are absolute, i.e.¬†the algorithm will not search outside this range.\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe simulator will ignore the ranges with the default value of NULL for the limits argument to PM_sim. If the simulator limits argument is set to NA, it will mean that these ranges will be used as the limits to truncate the simulation.\n\nExample:\n\n#Pri\nKE, 0, 5\nV, 0.01, 100\nKA, 0, 5\n\n\n\n\n\n5.3.3 COVariates\nCovariates are subject-specific data, such as body weight, contained in the data. The covariate names, which are the column names in the data file or PM_data object, must be declared if used in the model object. Once declared, they can be used in secondary variable and differential equations. The names should be the same as in the data file.\nBy default, missing covariate values are linearly interpolated between existing values, or carried forward if the first value is the only non-missing entry. However, you can suppress interpolation and carry forward the previous value in a piece-wise constant fashion, depending on the way you define the model as described below.\n\n5.3.3.1 App\nComing soon.\n\n\n\n5.3.3.2 List\nThe covariate element is a list whose names are the same as the covariates in the data file, and whose values are the interp creator function to declare how each covariate is interpolated between entries in the data.\nThe default argument for interp is ‚Äúlm‚Äù which means that values will be linearly interpolated between entries, like the R linear model function lm. The alternative is ‚Äúnone‚Äù, which holds the covariate value the same as the previous entry until it changes, i.e., a carry-forward strategy.\n\nmod &lt;- PM_model$new(\n  pri = list(...),\n  cov = list(\n      wt = interp(),\n      age = interp(\"none\")\n    )\n)\n\nHere, wt will be linearly interpolated and age will be piece-wise constant, i.e.¬†held constant until the next entry in the data file.\n\n\n5.3.3.3 File\nList the covariates by name, one per line in the #COV block. To make a covariate piece-wise constant, include an exclamation point (!) in the declaration line.\nNote that any covariate relationship to any parameter may be described as the user wishes by mathematical equations and R code, allowing for exploration of complex, non-linear, time-dependent, and/or conditional relationships. These equations are included in any of the blocks which are functions (SEC, EQN, INI, FA, LAG, OUT).\nExample:\n\n#Cov\nwt\ncyp\nIC!\n\nHere, IC will be piece-wise constant and the other two will be linearly interpolated for missing values.\n\n\n\n5.3.4 Secondary\nSecondary variables are those that are defined by equations that are combinations of primary, covariates, and other secondary variables. Pmetrics does NOT generate distributions for the values of secondary variables. They are only used internally to define the model. Variables declared in the secondary block are global, i.e., they are available to all other blocks. This is in contrast to variables declared within other function blocks (INI, FA, LAG, OUT), which are only available within the block they are declared.\n\n5.3.4.1 App\nComing soon.\n\n\n\n5.3.4.2 List\nSpecify each variable equation as a list of unnamed character elements in the same way as for the app. In the example below, V0 is the primary parameter which will be estimated, but internally, the model uses V as V0*wt, unless age is &gt;18, in which case weight is capped at 75 kg. It‚Äôs the same for CL0. Note that the conditional statement is not named.\n\nmod &lt;- PM_model$new(\n    pri = list(\n      CL0 = ab(0, 5),\n      V0 = msd(10, 3)\n    ),\n    cov = list(\n      wt = interp(),\n      age = interp()\n    ),\n    sec = function(){\n      V = V0*wt\n      if (age &gt;18) {V = V0 * 75}\n      CL = CL0 * wt\n    }\n) # end of $new()\n\n\n\n5.3.4.3 File\nFormat is the same as for equations in the list.\nExample:\n\n#Sec\nCL = Ke * V * wt**0.75\nif (cyp &gt; 1) {CL = CL * cyp}\n\n\n\n\n5.3.5 INItial conditions\nBy default, all model compartments have zero amounts at time 0. However, you can change the default initial condition of any compartment from 0 to something else. It can be an fixed value, primary or secondary variables, or covariate(s), or equations/conditionals based on these.\n\n5.3.5.1 App\nComing soon. \n\n\n5.3.5.2 List\nInitial conditions can be changed as a function called ‚Äúini‚Äù. Each line of the function specifies the compartment amount as ‚ÄúX[.] = expression‚Äù, where ‚Äú.‚Äù is the compartment number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in R syntax.\n\nmod &lt;- PM_model$new(\n    pri = list(\n      Ke = ab(0, 5),\n      V = msd(100, 30),\n      IC3 = ab(0, 1000)\n    ),\n    cov = list(\n      wt = interp(),\n      age = interp(),\n      IC2 = interp(\"none\")\n    ),\n    ini = function(){\n      X[1] = IC2*V\n      X[3] = IC3\n    }\n) # end of $new()\n\nIn the example above, IC2 is a covariate with the measured trough concentration prior to an observed dose and IC3 is a fitted primary parameter specifying an initial amount in unobserved compartment 3.\nIn the first case, the initial condition for compartment 2 becomes the value of the IC2 covariate (defined in cov list) multiplied by the current estimate of V during each iteration. This is useful when a subject has been taking a drug as an outpatient, and comes in to the lab for PK sampling, with measurement of a concentration immediately prior to a witnessed dose, which is in turn followed by more sampling. In this case, IC2 or any other covariate can be set to the initial measured concentration, and if V is the volume of compartment 2, the initial condition (amount) in compartment 2 will now be set to the measured concentration of drug multiplied by the estimated volume for each iteration until convergence.\nIn the second case, the initial condition for compartment 3 becomes another variable, IC3 defined in the pri list, to fit in the model, given the observed data.\n\n\n5.3.5.3 File\nThe same example as for the list above is shown below in the format for the file.\n\n#Ini\nX[2] = IC*V\nX[3] = IC3\n\n\n\n\n\n5.3.6 FA (bioavailability)\nIn this tab you can change the default bioavailability of any bolus input from 1 to something else. It can be an equation, primary or secondary variable, or covariate.\n\n5.3.6.1 App\nComing soon.\n\n\n\n5.3.6.2 List\nBioavailability for any bolus input can be changed from the default value of 1. Use a function called ‚Äúfa‚Äù, where each line is of the form ‚ÄúFA[.] = expression‚Äù, and ‚Äú.‚Äù is the input number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements.\n\nmod &lt;- PM_model$new(\n    pri = list(\n      Ke = ab(0, 5),\n      V = msd(100, 30),\n      FA1 = ab(0, 1)\n    ),\n    fa = function(){\n      FA[1] = FA1\n    }\n)\n\n\n\n5.3.6.3 File\nThe same example as for the list above is shown below in the format for the file.\n\n#Fa\nFA[1] = FA1\n\n\n\n\n5.3.7 LAG time\nThe lag time is a delay in absorption for a bolus input.\n\n5.3.7.1 App\nComing soon.\n\n\n\n5.3.7.2 List\nUse a function called ‚Äúlag‚Äù, each line of the form ‚ÄúLAG[.] = expression‚Äù, where ‚Äú.‚Äù is the input number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements.\n\nmod &lt;- PM_model$new(\n    pri = list(\n      Ke = ab(0, 5),\n      V = msd(100, 30),\n      lag1 = ab(0, 4)\n    ),\n    lag = function(){\n      LAG[1] = lag1\n    }\n)\n\n\n\n5.3.7.3 File\nThe same example as for the list above is shown below in the format for the file.\n\n#Lag\nLAG[1] = Tlag1\n\n\n\n\n5.3.8 EQuatioNs\nThese are the equations that define the structural model, i.e., the mathematical expressions that relate input (dose) to output (measurements). Pmetrics has a library of models with algebraic solutions and models can also use differential equations in a format compatible with R. Even algebraic models will contain differential equations for purposes of understanding and plotting the model, but algebraic models from the library include a token which tells Pmetrics how to choose the correct model. Details below.\n\n5.3.8.1 App\nComing soon.\n\n\n\n5.3.8.2 List\nSpecify a model as a function called ‚Äúeqn‚Äù, with each element an ordinary differential equation in R syntax. Additional equations can be included.\nNote 1: Local variables defined within the eqn function are not available outside the function. If you wish to use a variable in other blocks, define it in the sec function.\nNote 2: If your data file has dose inputs with DUR = 0, these are considered to be instantaneous bolus inputs, and you must use B[.] or BOLUS[.] to represent them in the equations. If your data file has dose inputs with DUR &gt; 0, these are considered to be infusions, and you should use R[.] or RATEIV[.] to represent them in the equations.\n\nmod &lt;- PM_model$new(\n    pri = list(\n      Ka = ab(0, 5),\n      Ke = ab(0, 5),\n      V = msd(100, 30),\n      Kcp = ab(0, 5),\n      Kpc = ab(0, 5)\n    ),\n    eqn = function(){\n      ktotal = Ke + Kcp # local variable, not available outside eqn block\n      dX[1] = B[1] - Ka * X[1]\n      dX[2] = R[1] + Ka * X[1] - (ktotal) * X[2] + Kpc * X[3]\n      dX[3] = Kcp * X[2] - Kpc * X[3]\n    }\n)\n\nTo specify models from the library, first ensure the correct library model name by using the model_lib function. Also, ensure that the variable names in the library are defined somewhere in the model (mostly in the PRI block), and similarly that OUT equations are correct.\n\nmod &lt;- PM_model$new(\n    pri = list( # parameter names match those listed in model_lib(), except V0\n      Ka = ab(0, 5),\n      Ke = ab(0, 5),\n      V0 = msd(10, 3),\n      Kcp = ab(0, 5),\n      Kpc = ab(0, 5)\n    ),\n    cov = list(\n        wt = interp()\n    ),\n    sec = function(){\n        V = V0 * wt # here we define the last parameter, V, found in model_lib() for this model\n    }\n    eqn = function(){\n        \"three_comp_bolus\" # name acquired from model_lib()\n    }, \n    out = function(){\n        Y[1] = X[2]/V # correct compartment (2) identified as the output\n    },\n    err = list(\n        proportional(1, c(1, 0.1, 0, 0))\n    )\n)\n\n\n\n5.3.8.3 File\nUse the same syntax as in the R function in a list specification.\nExample:\n\n#EQN\nktotal = Ke + KCP\ndX[1] = B[1] -KA*X[1]\ndX[2] = R[1] + KA*X[1] - (ktotal)*X[2] + KPC*X[3]\ndX[3] = KCP*X[2] - KPC*X[3]\n\nNote: Pmetrics no longer recognizes the old Fortran format of XP(1), which is dX[1], and X(1), which is X[1].\n\n\n\n5.3.9 Outputs\nThe outputs in Pmetrics are the values in the OUT column of the data that you are trying to predict. In the model objects, each output is referred to as Y[.], where ‚Äú.‚Äù is the number of the output and the same as the corresponding OUTEQ in the data. Outputs can be defined as mathematical combinations of compartment amounts (X[.]), primary and/or secondary parameters, or covariates.\nOutput equations are in R format. If they include conditional statements, these should follow R‚Äôs if(){} convention.\n\n5.3.9.1 App\nComing soon.\n\n\n\n5.3.9.2 List\nThe out element of the model list is function. Any R code is valid within the function. Secondary variables declared here will only be available within the function. The output equations are of the form ‚ÄúY[.] = expression‚Äù, where ‚Äú.‚Äù is the output equation number in the data. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in R code.\n\nout = function(){\n  Y[1] = X[1]/V\n}\n\n\n\n5.3.9.3 File\nOutputs are of the form Y[.] = expression, where ‚Äú.‚Äù is the output equation number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in Fortran code. An ‚Äú&‚Äù continuation prefix is not necessary in this block for any statement, although if present, will be ignored. There can be a maximum of 6 outputs. They are referred to as Y[1], Y[2], etc. These equations may also define a model explicitly as a function of primary and secondary variables and covariates.\nExamples:\n\n#Out\nY[1] = X[2]/V\n\nHere‚Äôs an example of an explicit model defined in the output and not the equation block.\n\n#OUT\n\nRES = BOLUS[1] * KIN/(KIN-KOUT) * (EXP(-KOUT*TPD)-EXP(-KIN*TPD))\nY[1] = RES/VD\n\n\n\n\n5.3.10 Error\nAll models predict observations with error. Part of this error is due to measurement or assay error. The assay error in Pmetrics is explicitly accounted for, and it may be inflated by an additive model error component \\(\\lambda\\) or a proportional component \\(\\gamma\\) that reflect additional noise and model misspecification. The remaining error is random and not optimized.\nWhen fitting, the error in a prediction determines how closely the model must match the observation. Pmetrics weights predictions by \\(1/error^2\\). The standard deviation of an prediction is calculated from the assay error model as \\(SD_{pred} = C0 + C1*pred + C2*pred^2 + C3*pred^3\\). Error is then calculated according to the selected model error structure:\n\nProportional: \\(error = \\gamma * SD_{pred}\\)\nAdditive: \\(error = \\lambda + SD_{pred}\\)\n\nNote: Each output equation must have an error model. In Pmetrics versions prior to 3.0.0, each output equation had its own assay error polynomial, but there was only one model error for all outputs. In Pmetrics ‚â• 3.0.0, each output equation has its own assay error polynomial and its own model error, allowing for greater flexibility in modeling complex data.\n\n5.3.10.1 App\nComing soon.\n\n\n5.3.10.2 List\nThe error list element is a list of creator functions. The two possible creator functions are proportional or additive. Each of these functions has the same arguments: initial, coeff, and fixed.\n\nThe initial argument is the starting value for \\(\\gamma\\) in the proportional() creator function or \\(\\lambda\\) for the additive() creator function.\nFor both creators, coeff is the vector of 4 numbers that defines a polynomial equation to permit calculation of the standard deviation of an observation, based on the noise of the assay (see makeErrorPoly).\nThe final argument fixed is FALSE by default, which means that \\(\\gamma\\) or \\(\\lambda\\) will be estimated for each output equation as measures of additional noise in the data and/or model misspecification. If fixed is set to TRUE, then the value in initial will be held constant during estimation.\n\nIn the code snippet below, there are two output equations so there are two error models. The first is a \\(\\gamma\\) proportional model with starting value 1, which will be updated based on the model fit of the data, and assay polynomial coefficients of 0.15, 0.1, 0, and 0. The second is an additive \\(\\lambda\\) model with starting value 0.1, assay polynomial coefficients of 0.1, 0, 0, and 0, and because fixed = TRUE, it will not be estimated and will be held constant at 0.1.\n\nmod &lt;- PM_model$new(\n  out = function(){\n    Y[1] = X[1]/V1\n    Y[2] = X[2]/V2\n  },\n  err = list(\n    proportional(1, c(0.15, 0.1, 0, 0)),\n    additive(0.1, c(0.1, 0, 0, 0), fixed = TRUE)\n  )\n)\n\nMore complete examples.\n\nmod &lt;- PM_model$new(\n  pri = list(\n    Ke = ab(0, 5),\n    V = msd(100, 30)\n  ),\n  eqn = function(){\n    one_comp_iv\n  },\n  out = function(){\n    Y[1] = X[1]/V\n  },\n  err = list(\n    proportional(5, c(0.05, 0.1, 0, 0))\n  )\n)\n      \nmod2 &lt;- PM_model$new(\n  pri = list(\n    kin = ab(0, 5),\n    kout = ab(0, 5),\n    tpd = ab(0, 5),\n    V = msd(100, 30)\n  ),\n  sec = function(){\n    res = b[1] * kin/(kin-kout) * (exp(-kout*tpd)-exp(-kin*tpd))\n  },\n  out = function(){\n    Y[1] = res/v\n  },\n  err = list(\n    additive(0.4, c(0.3, 0.15, 0, 0))\n  )\n)\n\nThis last example is known as the Bateman equation for a model with linear absorption (KIN) into and elimination (KOUT) from a central compartment, and a time post-dose (TPD) or lag time. Here B[1] is the oral bolus dosing vector for drug 1, and V is the volume of the central compartment.\n\n\n5.3.10.3 File\nUnlike the R6 model builder app or model list, the error block in the file is separated from the output block. This is to maintain backward compatibility with Legacy Pmetrics.\nTo specify the model in this block, the first line is either L=number or G=number for a \\(\\lambda\\) or \\(\\gamma\\) error model. The number is the starting value for \\(\\lambda\\) or \\(\\gamma\\). If you include an exclamation point (!) in the declaration, then \\(\\lambda\\) or \\(\\gamma\\) will be fixed and not estimated. Recall that you can only fix \\(\\lambda\\) currently to zero.\nThe next line(s) contain the values for the assay error polynomial coefficients: \\(C0\\), \\(C1\\), \\(C2\\), and \\(C3\\), separated by commas. There should be one line of coefficients for each output equation. By default Pmetrics will use values for these coefficients found in the data file. If none are present or if the model declaration line contains an exclamation point (!) the values here will be used.\nExample 1: estimated \\(\\lambda\\), starting at 0.4, one output, use data file coefficients but if missing, use 0.1,0.1,0,0.\n\n#Err\nL=0.4\n0.1,0.1,0,0\n\n\nExample 2: fixed \\(\\gamma\\) of 2, two outputs, use data file coefficients but if missing, use 0.1,0.1,0,0 for the first output, but use 0.3, 0.1, 0, 0 for output 2 regardless of what is in the data file.\n\n#Err\nG=2!\n0.1,0.1,0,0\n0.3,0.1,0,0!\n\n\n\n\n\n\n5.3.11 Complete File Example\nHere is a complete example of a model file, as of Pmetrics version 3.0 and higher:\n\n#Pri\nKE, 0, 5\nV0, 0.1, 100\nKA, 0, 5\nLag1, 0, 3\n\n#Cov\nwt\nC this weight is in kg\n\n#Sec\nV = V0*wt\n\n#Lag\nLAG[1] = Tlag1\n#Eqn\ntwo_comp_bolus\n\n#Out\nY[1] = X[2]/V\n\n#Err\nL=0.4\n0.1, 0.1, 0, 0\n\n\nNotes:\nThe value of ‚Äútwo_comp_bolus‚Äù in the #Eqn block tells Pmetrics to use the algebraic solution for the model. The #Pri block contains the primary parameters and their initial ranges, which are the only parameters that will be estimated. The #Cov block contains the covariate names. The #Sec block contains the global secondary equations used to incorporate the covariate ‚Äúwt‚Äù in the model definition. The #Lag block contains the lag time for the bolus input. The #Out block contains the output equation. The relevant compartment number that contains the amount of drug, 2, is obtained by looking at model_lib() to see which compartment is the central, so that it can be divided by V to obtain concentration. The #Err block contains the model error structure (lambda, additive) with a starting value of 0.4, and assay error coefficients of 0.1, 0.1, 0, and 0.\n\nThe comment line ‚ÄúC this weight is in kg‚Äù will be ignored.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Models</span>"
    ]
  },
  {
    "objectID": "models.html#update-model",
    "href": "models.html#update-model",
    "title": "5¬† Models",
    "section": "5.4 Updating models",
    "text": "5.4 Updating models\n\n\n5.4.1 List\nBecause models are loaded as memory items in R6 Pmetrics, they can be modified in R without having to edit text files. This function is accessed via the $update() method for PM_model objects.\nAll R6 objects are mini-environments, so direct copies of an R6 environment are in the same environment and changes to one will change them all. This means the following code will likely not work as intended.\n\nmod2 &lt;- mod1\nmod2$update(...)\n\nWhen mod2 is updated, mod1 will update as they are in the same environment. The way to create an independent copy of an R6 object, which does not share the same environment, is to use the $clone() method available for all R6 objects.\n\nmod2 &lt;- mod1$clone()\nmod2$update(...)\n\nNow changes to mod2 do not propagate to mod1.\nTo update a model, simply supply the list items you wish to change with the new values.\n\nmod2$update(\n   pri = list(\n    Ke = ab(1, 3),\n    V = NULL,\n    V0 = ab(0, 20)\n   ),\n  sec = function(){\n    V = V0 * wt\n  }\n)\n\nThis example changes the range of Ke, deletes V, adds V0, and defines a new secondary relationship for V = V0 * wt.\n\n\n5.4.2 File\nThe only way to update a model file is to edit the text file and load it with PM_model$new(). The advantage is that it is quick and relatively easy. The disadvantage is that you have to keep editing, copying and pasting files, and unless your documentation in R or elsewhere is good, you have no idea how you changed the model from run to run. In contrast, by using the $update() method in R6, you can see a written record of how the model evolved over the project.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Models</span>"
    ]
  },
  {
    "objectID": "models.html#reserved",
    "href": "models.html#reserved",
    "title": "5¬† Models",
    "section": "5.5 Reserved Names",
    "text": "5.5 Reserved Names\nThe following cannot be used as primary, covariate, or secondary variable names. They can be used in equations, however.\n\n\n\n\n\n\n\n\nReserved.Variable\nFunction.in.Pmetrics\n\n\n\n\nt\ntime\n\n\nx\narray of compartment amounts\n\n\ndx\narray of first derivative of compartment amounts\n\n\np\narray of primary parameters\n\n\nrateiv / r\ninfusion vector\n\n\nbolus / b\nbolus vector\n\n\ncov\ncovariate hashmap\n\n\ny\noutput vector",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>5</span>¬† <span class='chapter-title'>Models</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "4¬† Data",
    "section": "",
    "text": "4.1 Introduction\nJump to examples\nPmetrics always needs data and a model to run. Pmetrics data objects are typically read into memory from files. Although the file format is usually comma-separated (.csv), it is possible to use other separators, like the semicolon, by setting the appropriate argument with setPMoptions.\nsetPMoptions()\n# Choose \"Data File Reading\"\n# Changes field separator to \";\" from default \",\"\n# and decimal mark from \".\" to \",\"\nExamples of programs that can save .csv files are any text editor (e.g.¬†TextEdit on Mac, Notepad on Windows) or spreadsheet program (e.g.¬†Excel).\nIt is possible to create a data object in R directly, without reading a file. This is useful for simulation purposes, where you may want to create a small dataset on the fly. We‚Äôll cover this below.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#r6-objects",
    "href": "data.html#r6-objects",
    "title": "4¬† Data",
    "section": "4.2 R6 objects",
    "text": "4.2 R6 objects\nMost Pmetrics objects, including data, follow the R6 framework. The idea of this object is to represent a dataset that is going to be modeled/simulated. All its behaviour is represented by the class PM_data. This class allows datasets to be checked, plotted, written to disk and more. Use PM_data$new(\"filename\") to create a PM_data object by reading the file.\n\n# assume that data.csv is in the working directory\ndata1 &lt;- PM_data$new(\"data.csv\")\n\nYou can also build an appropriate data frame in R and provide that as an argument to PM_data$new().\n\n# assume df is data frame with at least these columns:\n# id, time, dose, out\ndata1 &lt;- PM_data$new(df)\n\nLastly, you can take advantage of the addEvent method in PM_data objects to build a data object on the fly. This can be particularly useful for making quick simulation templates. Start with an empty call to PM_data$new() and add successive rows. See PM_data for details under the addEvent method.\n\ndat &lt;- PM_data$new()$\n    addEvent(id = 1, time = 0, dose = 100, addl = 5, ii = 24)$\n    addEvent(id = 1, time = 144, out = -1)$\n    addEvent(id = 1, wt = 75, validate = TRUE)\n\nNotes on the above statements:\n\nLack of time element in the last addEvent will add wt=75 to all rows for id = 1\nUse validate = TRUE as an argument in the last addEvent to finalize creation\nYou can chain addEvent as shown above by including the $ between events.\n\nAdvanced concept: For those familiar with tidyverse or the native R pipe to join functions (‚Äú%&gt;%‚Äù or ‚Äú|&gt;‚Äù, respectively), chaining in R6 is similar but restricted to methods defined for the object. In this case we chain the addEvent methods. We could even chain an additional PM_data method like $plot() at the end of the above code. However, that would create dat as a plotly plot object, not a PM_data one.\nBelow you see the data standardization and validation reports that are generated when you create a new PM_data object, and the output of typing dat$data and dat$standard_data look like in the viewer. The former is your original data, and the latter is what it looks like after standardization to the full Pmetrics format.\nOnce you have created the PM_data object, you never need to create it again during your R session. You also don‚Äôt have to bother copying the data file to the Runs folder each time you run the model, like you used to do with older (‚ÄúLegacy‚Äù) versions of Pmetrics. The data are stored in memory and can be used in any Pmetrics function that needs it.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#data-format",
    "href": "data.html#data-format",
    "title": "4¬† Data",
    "section": "4.3 Data format",
    "text": "4.3 Data format\nR6 Pmetrics can use file or data frame input. The format is very flexible. The only required columns are those below. Unlike Legacy Pmetrics, there are no requirements for a header or to prefix the ID column with ‚Äú#‚Äù. However, any subsequent row that begins with ‚Äú#‚Äù will be ignored, which is helpful if you want to exclude data from the analysis, but preserve the integrity of the original dataset, or to add comment lines. The column order can be anything you wish, but the names should be the same as below. Ultimately, PM_data$new() converts all valid data into a standardized format, which is the same as used in Legacy Pmetrics.\n\nID This field can be numeric or character and identifies each individual. All rows must contain an ID, and all records from one individual must be contiguous. IDs may be any alphanumeric combination. The number of subjects is unlimited.\nTIME This is the elapsed time in decimal hours since the first event, which is always TIME  = 0, unless you specify TIME as clock time. In that case, you must nclude a DATE column, described below. For clock time, the default format is HH:MM. Other formats can be specified. See PM_data for more details. Every row must have an entry, and within a given ID, rows must be sorted chronologically, earliest to latest.\nDATE This column is only required if TIME is clock time, detected by the presence of ‚Äú:‚Äù. The default format of the date column is YYYY-MM-DD. As for TIME, other formats can be specified. See PM_data for more details.\nDOSE This is the dose amount. It should be ‚Äú.‚Äù for observation rows. All sujects must have a dose event at time 0, which is the first row for that subject. The dose amount can be any numeric value, including 0. If the dose is an infusion, the DUR column must also be included. In other software packages, DOSE is equivalent to AMT.\nOUT This is the observation, or output value, and it is always required. If EVID = 0, there must be an entry. For such events, if the observation is missing, e.g.¬†a sample was lost or not obtained, this must be coded as -99. It will be ignored for any other EVID and therefore should be ‚Äú.‚Äù. OUT can be coded as DV in other software packages. When OUT = -99, this is equivalent to MDV = 1, or missing dependent variable in other packages, but Pmetrics does not use MDV.\nCOVARIATES‚Ä¶ Any column named other than above is assumed to be a covariate, one column per covariate. The first row for any subject must have a value for all covariates, since the first row is always a dose. Covariates are handled differently than in Legacy Pmetrics. In Legacy, they were only considered at the times of dose events (EVID = 1 or EVID = 4). In Pmetrics 3.0 and later, they are considered at all times, including observation events (EVID = 0). Therefore, to enter a new covariate value at a time other than a dose or an observation, create a row at the appropriate time (and possibly date if using clock/calendar), making the row either a dose row with DOSE = 0 or an observation row with OUT = -99 (missing). By default, covariate values are linearly interpolated between entries. This is useful for covariates like weight, which may vary from measurement to measurement. You can change this behavior in the model definition to make them piece-wise constant, i.e.¬†carried forward from the previous value until a new value causes an instant change. This could be used, for example, to indicate periods of off and on dialysis. See the chapter on Models for more details.\n\nWhen PM_data reads a file, it will standardize it to the format below. This means some inferences are made. For example, in the absence of EVID, all doses are interpreted as oral. If they are infusions, DUR must be included to indicate the duration of the infusion. EVID only needs to be included if EVID=4 (reset event) is required, described below. Similarly, INPUT and OUTEQ are only required if multiple inputs or outputs are being modeled. Lastly, ADDL and II are optional.\nLastly, the standardized data are checked for errors and if found, Pmetrics generates a report with the errors and will attempt to fix those that it can.\n\n4.3.1 Standardized Data\nThe order, capitalization and names of the header and the first 13 columns are fixed. All entries must be numeric, with the exception of ID and ‚Äú.‚Äù for non-required placeholder entries. Any subsequent row that begins with ‚Äú#‚Äù will be ignored, as above.\nA full example data file is below, with details following.\n\nID See above.\nEVID This is the event ID field. It can be 0, 1, or 4. It is only required if EVID = 4 is included in the data, in which case every row must have an entry. If there are no EVID = 4 events, the entire EVID column can be omitted from the data.\n\n0 = observation\n1 = input (e.g.¬†dose)\n2, 3 are currently unused\n4 = reset, where all compartment values are set to 0 and the time counter is reset to 0. This is useful when an individual has multiple sampling episodes that are widely spaced in time with no new information gathered. This is a dose event, so dose information needs to be complete. The TIME value for EVID = 4 should be 0, and subsequent rows should increase monotonically from 0 until the last record or until another EVID = 4 event, which will restart time at 0.\n\nTIME See above.\nDATE See above.\nDUR This is the duration of an infusion in hours. If EVID = 0 (observation event), DUR is ignored and should have a ‚Äú.‚Äù placeholder. For a bolus (e.g.¬†an oral dose), set the value equal to 0. As mentioned above, if all doses are oral, DUR can be omitted from the data altogether. Some other packages use RATE instead of DUR, but of course, one can convert rate to duration with DUR = DOSE / RATE.\nDOSE See above.\nADDL This specifies the number of additional doses to give at interval II. ADDL can be positive or negative. If positive, it is the number of doses to give after the dose at time 0. If negative, it is the number of doses to give before the dose at time 0. It may be missing (‚Äú.‚Äù) for dose events (EVID = 1 or EVID = 4), in which case it is assumed to be 0. It is ignored for observation (EVID = 0) events. Be sure to adjust the time entry for the subsequent row, if necessary, to account for the extra doses. All compartments in the model will contain the predicted amounts of drug at the end of the II interval after the last ADDL dose.\nII This is the interdose interval and is only relevant if ADDL is not equal to 0, in which case II cannot be missing. If ADDL = 0 or is missing, II is ignored.\nINPUT This defines which input (i.e.¬†drug) the DOSE corresponds to. The model defines which compartments receive the input(s). If only modeling one drug, INPUT is unnecessary, as all values will be assumed to be 1. Other packages may use CMT for compartment for both inputs and outputs. It is necessary to separate these in Pmetrics and for outputs, designate the corresponding model input number with INPUT (e.g.¬†RATEIV[x] or B[x] for infusions and boluses in the model object), not the compartment.\nOUT See above.\nOUTEQ This is the output equation number that corresponds to the OUT value. Output equations are defined in the model file. If only modeling one output, this column is unnecessary, as all values are assumed to be 1. As discussed in INPUT, other packages may use CMT for compartment for both inputs and outputs. It is necessary to separate these in Pmetrics and for outputs, designate the corresponding model output equation number with OUTEQ, not the compartment.\nCENS This is a new column as of Pmetrics 3.0.0. It indicates whether the observation is censored, i.e.¬†below a lower limit of quantification or above an upper limit . It can take on four values:\n\nMissing for dose events which are not observations. Use a ‚Äú.‚Äù as a placeholder in your data file.\n0 = not censored\n1 = left censored (below lower limit of quantification)\n2 = right censored (above upper limit of quantification)\n\nIf there are no censored observations, the entire CENS column can be omitted from the data. In data fitting, left censored observations are handled using the M3 method described by Beal (bealWaysFitPK2001a?). Right censored observations are handled similarly, but using the complementary probability. The value in the OUT column is the censoring lower limit of quantification (LLOQ) for left censored observations. It is the upper limit of quantification (ULOQ) for right censored observations. For uncensored observations, OUT is the observed value as usual.\nC0, C1, C2, C3 These are the coefficients for the assay error polynomial for that observation. Each subject may have up to one set of coefficients per output equation. If more than one set is detected for a given subject and output equation, the last set will be used. If there are no available coefficients, these cells may be omitted. If they are included, for events which are not observations, they can be filled with ‚Äú.‚Äù as a placeholder. In data fitting, if the coefficients are present in the data file, Pmetrics will use them. If missing, Pmetrics will look for coefficients defined in the model.\nCOVARIATES‚Ä¶ See above.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#manipulation-of-csv-files",
    "href": "data.html#manipulation-of-csv-files",
    "title": "4¬† Data",
    "section": "4.4 Manipulation of CSV files",
    "text": "4.4 Manipulation of CSV files\n\n4.4.0.1 Read\nAs we have seen, PM_data$new(\"filename\") will read an appropriate data file in the current working directory to create a new PM_data object.\n\n\n4.4.0.2 Save\nPM_data$save(\"filename\") will save the PM_data object to a file called ‚Äúfilename‚Äù. This can be useful if you have loaded or created a data file and then changed it in R.\n\n\n4.4.0.3 Standardize\nPM_data$new() automatically standardizes the data into the full format. This includes conversion of calendar date / clock time into decimal elapsed time.\n\n\n4.4.0.4 Validate\nPM_data$new() automatically calls PMcheck so the data are validated as the data object is created.\n\n\n4.4.0.5 Data conversion\n\nPMwrk2csv() This function will convert old-style, single-drug USC*PACK .wrk formatted files into Pmetrics data .csv files. \nNM2PM() Although the structure of Pmetrics data files is similar to NONMEM, there are some differences. This function attempts to automatically convert to Pmetrics format. It has been tested on several examples, but there are probably NONMEM files which will cause it to crash.",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#examples",
    "href": "data.html#examples",
    "title": "4¬† Data",
    "section": "4.5 Examples",
    "text": "4.5 Examples\nLet‚Äôs start by setting the working directory to where the data files are located. This is usually the ‚Äúsrc‚Äù folder, but it can be anywhere you like. The working directory we want to move to can be specified as an absolute path or as a relative path.\n\n# absolute\nsetwd(\"full path to 'src' folder here\") \n# relative, if `src` is a subfolder of the current working directory\nsetwd(\"src\")\n\n# List the files inside the current working directory \nlist.files()\n\nPmetrics comes with an example dataset called dataEx already loaded. You can practice with it.\n\n# Save it to your current working directory\ndataEx$save(\"ex.csv\")\n\n# Save it to elsewhere\ndataEx$save(\"/mypath/ex.csv\")\n\n# Load it again from current working directory or from elsewhere\nexData &lt;- PM_data$new(\"ex.csv\")\nexData &lt;- PM_data$new(\"/mypath/ex.csv\")\n\nYou can look at the ex.csv file directly by opening from your hard drive it in a spreadsheet program like Excel, or a text editor.\nexData is an R6 object, which means that contains both data and methods to process that data.\n\n# See the contents of the object\nnames(exData)\n\nThe first element is an artifact of the R6 class. The remaining elements are documented in the help for PM_data. You can of course inspect the data directly.\n\n# Your original data (first few rows)\nhead(exData$data)\n\n\n# See the standardized data nicely formatted in the viewer (truncated for brevity)\nexData\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nevid\ntime\ndur\ndose\naddl\nii\ninput\nout\nouteq\ncens\nc0\nc1\nc2\nc3\nwt\nafrica\nage\ngender\nheight\n\n\n\n\n1\n1\n0\n0\n600\nNA\nNA\n1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n1\n1\n24\n0\n600\nNA\nNA\n1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n1\n1\n48\n0\n600\nNA\nNA\n1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n1\n1\n72\n0\n600\nNA\nNA\n1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n1\n1\n96\n0\n600\nNA\nNA\n1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n1\n0\n120\nNA\nNA\nNA\nNA\nNA\n10.44\n1\nnone\nNA\nNA\nNA\nNA\n46.7\n1\n21\n1\n160\n\n\n\n\n\nA method exists for all Pmetrics objects to summarize them.\n\nexData$summary() \n\nThe older S3 method to summarize will also work, but is less preferred: summary(exData).",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#citations",
    "href": "data.html#citations",
    "title": "4¬† Data",
    "section": "4.6 Citations",
    "text": "4.6 Citations",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>4</span>¬† <span class='chapter-title'>Data</span>"
    ]
  }
]